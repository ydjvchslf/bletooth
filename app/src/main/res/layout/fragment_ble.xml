<?xml version="1.0" encoding="utf-8"?>
<layout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools" >

    <data>
        <import type="android.view.View" />
        <variable
            name="viewModel"
            type="com.example.bledot.ble.BleViewModel" />
        <variable
            name="bleState"
            type="com.example.bledot.ble.BleState" />
    </data>

        <LinearLayout
            android:id="@+id/bleFragment"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:orientation="vertical"
            tools:context="com.example.bledot.ble.BleFragment">

            <!-- 툴바 영역 -->
            <androidx.constraintlayout.widget.ConstraintLayout
                android:id="@+id/main_toolbar"
                android:layout_width="match_parent"
                android:layout_height="50dp"
                app:layout_constraintTop_toTopOf="parent"
                app:layout_constraintLeft_toLeftOf="parent"
                app:layout_constraintRight_toRightOf="parent">

            <TextView
                android:id="@+id/title"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintBottom_toBottomOf="parent"
                app:layout_constraintTop_toTopOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                android:text="Device Connection"
                android:textSize="18sp"
                android:textColor="@color/black"/>

            </androidx.constraintlayout.widget.ConstraintLayout>

            <!-- 콘텐트 부분 -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                app:layout_constraintTop_toBottomOf="@+id/main_toolbar"
                app:layout_constraintBottom_toBottomOf="parent"
                android:orientation="vertical">

                <androidx.constraintlayout.widget.ConstraintLayout
                    android:layout_width="match_parent"
                    android:layout_height="match_parent">

                    <!-- NOT_SCANNED 레이아웃 -->
                    <androidx.constraintlayout.widget.ConstraintLayout
                        android:id="@+id/layout_before"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        app:layout_constraintTop_toTopOf="parent"
                        app:layout_constraintBottom_toBottomOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:visibility="@{viewModel.BLE_STATE == bleState.NOT_SCANNED ? View.VISIBLE : View.GONE}">

                    <ImageView
                        android:layout_width="50dp"
                        android:layout_height="100dp"
                        app:layout_constraintBottom_toTopOf="@id/ble_guide1_textView"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:layout_marginBottom="10dp"
                        android:src="@drawable/ic_bluetooth_not_connected" />

                    <TextView
                        android:id="@+id/ble_guide1_textView"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        app:layout_constraintTop_toTopOf="parent"
                        app:layout_constraintBottom_toBottomOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:textSize="18sp"
                        android:textColor="@color/black"
                        android:text="Bluetooth activation required" />

                    <TextView
                        android:id="@+id/ble_guide2_textView"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        app:layout_constraintTop_toBottomOf="@id/ble_guide1_textView"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:text="Bluetooth must be enabled to connect to the device." />

                    <TextView
                        android:id="@+id/ble_guide3_textView"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        app:layout_constraintTop_toBottomOf="@id/ble_guide2_textView"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:text="Please enable Bluetooth first." />

                    </androidx.constraintlayout.widget.ConstraintLayout>

                    <!-- 스캔 중 레이아웃 -->
                    <androidx.constraintlayout.widget.ConstraintLayout
                        android:id="@+id/layout_scanning"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        app:layout_constraintTop_toTopOf="parent"
                        app:layout_constraintBottom_toBottomOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:visibility="@{viewModel.BLE_STATE == bleState.SCANNING ? View.VISIBLE : View.GONE}">

                        <com.airbnb.lottie.LottieAnimationView
                            android:layout_width="50dp"
                            android:layout_height="50dp"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            app:layout_constraintBottom_toTopOf="@id/ble_scanning1_textView"
                            app:lottie_fileName="circular-loading-bar.json"
                            app:lottie_loop="true"
                            app:lottie_autoPlay="true"/>

                        <TextView
                            android:id="@+id/ble_scanning1_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toTopOf="parent"
                            app:layout_constraintBottom_toBottomOf="parent"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            android:textSize="18sp"
                            android:textColor="@color/main"
                            android:text="Scanning..." />

                        <TextView
                            android:id="@+id/ble_scanning2_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toBottomOf="@id/ble_scanning1_textView"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            android:text="Please wait a moment until the scan is complete." />

                    </androidx.constraintlayout.widget.ConstraintLayout>

                    <!-- BLE 스캔 후 발견 레이아웃 -->
                    <androidx.constraintlayout.widget.ConstraintLayout
                        android:id="@+id/layout_after"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:visibility="@{ (viewModel.BLE_STATE == bleState.SCAN_COMPLETE_DISCONNECTED) || (viewModel.BLE_STATE == bleState.SCAN_COMPLETE_CONNECTED) ? View.VISIBLE : View.GONE}" >

                        <androidx.constraintlayout.widget.Guideline
                            android:id="@+id/first_guideline"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintGuide_percent="0.3"
                            android:orientation="horizontal" />

                        <androidx.constraintlayout.widget.Guideline
                            android:id="@+id/second_guideline"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintGuide_percent="0.7"
                            android:orientation="horizontal" />

                        <TextView
                            android:id="@+id/ble_after1_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toTopOf="parent"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            app:layout_constraintBottom_toTopOf="@id/first_guideline"
                            android:textSize="18sp"
                            android:textColor="@color/black"
                            android:text="Scan Complete!" />

                        <TextView
                            android:id="@+id/ble_after2_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            app:layout_constraintTop_toBottomOf="@id/ble_after1_textView"
                            android:text="Please select a device to connect to." />

                        <TextView
                            android:id="@+id/device_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintStart_toStartOf="parent"
                            android:layout_marginStart="20dp"
                            app:layout_constraintTop_toBottomOf="@id/first_guideline"
                            android:textColor="@color/black"
                            android:text="Discovered Devices" />

                        <androidx.recyclerview.widget.RecyclerView
                            android:id="@+id/recyclerView"
                            android:layout_width="match_parent"
                            android:layout_height="0dp"
                            app:layout_constraintTop_toBottomOf="@id/device_textView"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            app:layout_constraintBottom_toTopOf="@id/second_guideline"
                            app:layoutManager="androidx.recyclerview.widget.LinearLayoutManager"
                            tools:listitem="@layout/layout_ble_item"
                            android:visibility="visible"/>

                        <!-- 스캔후 발견 후 연결 상태 -->
                        <LinearLayout
                            android:id="@+id/layout_connect"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toBottomOf="@id/second_guideline"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            android:orientation="horizontal"
                            android:gravity="center"
                            android:visibility="@{viewModel.mConnectionState == 2 ? View.VISIBLE : View.GONE}">

                        <ImageView
                            android:id="@+id/ic_circle"
                            android:layout_width="15dp"
                            android:layout_height="15dp"
                            android:layout_marginEnd="5dp"
                            android:src="@drawable/ic_blue_circle" />

                        <TextView
                            android:id="@+id/state_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="Connected" />

                        </LinearLayout>

                    </androidx.constraintlayout.widget.ConstraintLayout>

                    <!-- 연결됨 layout -->
                    <androidx.constraintlayout.widget.ConstraintLayout
                        android:id="@+id/layout_connected"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        app:layout_constraintTop_toTopOf="parent"
                        app:layout_constraintBottom_toBottomOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:visibility="@{viewModel.BLE_STATE ==  bleState.CONNECTED ? View.VISIBLE : View.GONE}" >
                        
                        <ImageView
                            android:id="@+id/big_circle"
                            android:layout_width="250dp"
                            android:layout_height="250dp"
                            app:layout_constraintTop_toTopOf="parent"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            android:layout_marginTop="40dp"
                            android:src="@drawable/big_circle_shadow" />

                        <ImageView
                            android:id="@+id/small_circle"
                            android:layout_width="90dp"
                            android:layout_height="90dp"
                            app:layout_constraintTop_toTopOf="@id/big_circle"
                            app:layout_constraintStart_toStartOf="@id/big_circle"
                            app:layout_constraintEnd_toEndOf="@id/big_circle"
                            app:layout_constraintBottom_toBottomOf="@id/big_circle"
                            android:src="@drawable/circle_shadow"/>

                        <TextView
                            android:id="@+id/battery_per"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toTopOf="@id/small_circle"
                            app:layout_constraintStart_toStartOf="@id/small_circle"
                            app:layout_constraintEnd_toEndOf="@id/small_circle"
                            app:layout_constraintBottom_toBottomOf="@id/small_circle"
                            android:text="99%"
                            android:textSize="15sp"
                            android:textColor="@color/white" />

                        <ImageView
                            android:id="@+id/ic_connected"
                            android:layout_width="15dp"
                            android:layout_height="15dp"
                            app:layout_constraintTop_toTopOf="@id/state_connected"
                            app:layout_constraintBottom_toBottomOf="@id/state_connected"
                            app:layout_constraintEnd_toStartOf="@id/state_connected"
                            android:layout_marginEnd="5dp"
                            android:src="@drawable/ic_blue_circle" />

                        <TextView
                            android:id="@+id/state_connected"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toBottomOf="@id/big_circle"
                            app:layout_constraintStart_toStartOf="@id/big_circle"
                            app:layout_constraintEnd_toEndOf="@id/big_circle"
                            android:layout_marginTop="50dp"
                            android:text="Connected" />

                        <LinearLayout
                            android:id="@+id/crn_device"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toBottomOf="@id/state_connected"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            android:layout_marginTop="30dp"
                            android:padding="20dp"
                            android:orientation="horizontal" >

                            <ImageView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:src="@drawable/ic_bluetooth_item" />

                            <TextView
                                android:id="@+id/name"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="name"
                                android:textSize="15sp"
                                android:layout_marginStart="20dp" />

                            <TextView
                                android:id="@+id/address"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="address"
                                android:textSize="15sp"
                                android:layout_marginStart="20dp" />

                            <TextView
                                android:id="@+id/state"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="state"
                                android:textSize="15sp"
                                android:layout_marginStart="20dp"
                                android:visibility="gone"/>

                            <TextView
                                android:id="@+id/battery"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="battery"
                                android:textSize="15sp"
                                android:layout_marginStart="20dp" />

                        </LinearLayout>

                        <TextView
                            android:id="@+id/disconnect_textView"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            app:layout_constraintTop_toBottomOf="@id/crn_device"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            android:layout_marginTop="50dp"
                            android:text="Disconnect"
                            android:textColor="@color/main" />

                    </androidx.constraintlayout.widget.ConstraintLayout>

                    <androidx.constraintlayout.widget.ConstraintLayout
                        android:id="@+id/ic_working"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        app:layout_constraintTop_toTopOf="parent"
                        app:layout_constraintBottom_toBottomOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        android:background="@color/grey_light"
                        android:visibility="@{viewModel.BLE_STATE == bleState.TRYING ? View.VISIBLE : View.GONE}">

                        <com.airbnb.lottie.LottieAnimationView
                            android:layout_width="50dp"
                            android:layout_height="50dp"
                            app:layout_constraintTop_toTopOf="parent"
                            app:layout_constraintBottom_toBottomOf="parent"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintEnd_toEndOf="parent"
                            app:lottie_fileName="circular-loading-bar.json"
                            app:lottie_loop="true"
                            app:lottie_autoPlay="true"/>

                    </androidx.constraintlayout.widget.ConstraintLayout>

                    <Button
                        android:id="@+id/scan_btn"
                        android:layout_width="300dp"
                        android:layout_height="47dp"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintBottom_toBottomOf="parent"
                        android:layout_marginBottom="20dp"
                        android:text="scan start"
                        android:textColor="@color/white"
                        android:background="@drawable/blue_btn_rounded_corner_rectangle"
                        android:visibility="@{(viewModel.BLE_STATE == bleState.NOT_SCANNED) || (viewModel.BLE_STATE == bleState.SCANNING) || (viewModel.BLE_STATE == bleState.SCAN_COMPLETE_CONNECTED) || (viewModel.BLE_STATE == bleState.SCAN_COMPLETE_DISCONNECTED) ? View.VISIBLE : View.GONE}"/>

                </androidx.constraintlayout.widget.ConstraintLayout>

            </LinearLayout>

        </LinearLayout>

</layout>